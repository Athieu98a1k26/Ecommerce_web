<div class="user-dashboard container-custom-xxl">
    <div class="row user-dashboard-wrap">
  <!-- Sidebar -->
  <aside class="user-sidebar col-md-4">
    <div class="user-profile">
      <img class="user-avatar" [src]="userAvatar || 'assets/img/user.png'" alt="User Avatar" />
      <div class="user-name">{{ userName }}</div>
    </div>
    <nav class="user-menu">
      <div 
        (click)="onChangeTab('Person')" 
        [ngClass]="{'user-menu-item': true, 'active': tabActive === 'Person'}">
        <i class="fa-regular fa-user"></i>
        Thông tin cá nhân
      </div>
      <div 
        (click)="onChangeTab('Order')" 
        [ngClass]="{'user-menu-item': true, 'active': tabActive === 'Order'}">
        <i class="fa-solid fa-bag-shopping"></i>
        Đơn hàng của tôi
      </div>
      <div 
        (click)="onChangeTab('History')" 
        [ngClass]="{'user-menu-item': true, 'active': tabActive === 'History'}">
        <i class="fa-solid fa-clock-rotate-left"></i>
        Lịch sử giao dịch
      </div>
      <div 
        (click)="onChangeTab('ChangePassword')" 
        [ngClass]="{'user-menu-item': true, 'active': tabActive === 'ChangePassword'}">
        <i class="fa-solid fa-lock"></i>
        Đổi mật khẩu
      </div>
      <div 
        (click)="onLogOut()" 
        [ngClass]="{'user-menu-item': true, 'logout': true}">
        <i class="fa-solid fa-right-from-bracket"></i>
        Đăng xuất
      </div>
    </nav>
  </aside>

  <!-- Main Content -->
  <main class="user-main-content col-md-9">
    <!-- Personal Info Card -->
    <section class="user-card personal-info-card" *ngIf="tabActive == 'Person'">
      <h2>Thông tin cá nhân</h2>
      <form (ngSubmit)="onSubmitPersonalInfo()">
        <div class="form-grid">
          <div class="form-group">
            <label for="fullName">Họ tên</label>
            <input id="fullName" type="text" class="form-control" [(ngModel)]="person.fullName" name="name" />
          </div>
          <div class="form-group">
            <label for="email">Email</label>
            <input id="email" type="email" class="form-control" [(ngModel)]="person.email" name="email" />
          </div>
          <div class="form-group">
            <label for="phoneNumber">Số điện thoại</label>
            <input id="phoneNumber" type="tel" class="form-control" [(ngModel)]="person.phoneNumber" name="phone" />
          </div>
        </div>
        <button type="submit" class="btn-green rounded">
          Cập nhật thông tin
        </button>
      </form>
    </section>

    <!-- Order Management Section -->
    <section class="user-card orders-section" *ngIf="tabActive == 'Order'">
      
      <div [style.display]="orderId ? 'none' : ''">
        <h3>Quản lý đơn hàng</h3>
          <!-- Tabs -->
          <ul class="order-tabs">
            <li class="tab-item" (click)="onChangeOrderTab('')" [ngClass]="{'active': tabOrder == ''}">Tất cả</li>
            <li class="tab-item" (click)="onChangeOrderTab('Init')" [ngClass]="{'active': tabOrder == 'Init'}">Khởi tạo</li>
            <li class="tab-item" (click)="onChangeOrderTab('Confirmed')" [ngClass]="{'active': tabOrder == 'Confirmed'}">Đã xác nhận</li>
            <li class="tab-item" (click)="onChangeOrderTab('Completed')" [ngClass]="{'active': tabOrder == 'Completed'}">Hoàn thành</li>
            <li class="tab-item" (click)="onChangeOrderTab('Cancelled')" [ngClass]="{'active': tabOrder == 'Cancelled'}">Đã hủy</li>
          </ul>
          <!-- Orders List -->
          <div class="container-fluid">
            <div class="card">
              <div class="card-body">
                <div class="table-responsive">
                  <table class="table table-striped table-bordered" [busy]="isTableLoading">
                    <thead class="bg-light">
                      <tr>
                        <th>{{ "OrderCode" | localize }}</th>
                        <th>{{ "FullName" | localize }}</th>
                        <th>{{ "Note" | localize }}</th>
                        <th>{{ "Price" | localize }}</th>
                        <th>{{ "OrderStatus" | localize }}</th>
                        <th style="width: 20%;">{{ "Actions" | localize }}</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr
                        *ngFor="
                          let order of orders
                            | paginate
                              : {
                                  id: 'server',
                                  itemsPerPage: pageSize,
                                  currentPage: pageNumber,
                                  totalItems: totalItems
                                }
                        "
                      >
                        <td>{{ order.code }}</td>
                        <td>{{ order.fullName }}</td>
                        <td>{{ order.note }}</td>
                        <td>{{ order.price | currency:'VND':'symbol':'1.0-0':'vi-VN' }}</td>
                        <td>{{ order.orderStatus | localize }}</td>
                        <td>
                          <button class="btn btn-primary" (click)="viewOrderDetail(order)">{{ "ViewDetail" | localize }}</button>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
              <div class="card-footer table-card-footer bg-light border-top">
                <div class="row">
                  <div class="col-sm-4 col-12 text-sm-left text-center">
                    <button class="btn btn-secondary" (click)="refresh()">
                      <i class="fas fa-redo-alt"></i>
                    </button>
                  </div>
                  <div class="col-sm-4 col-12 text-center">
                    <p class="mb-0 my-2">
                      {{ "TotalRecordsCount" | localize: totalItems }}
                    </p>
                  </div>
                  <div class="col-sm-4 col-12">
                    <div class="float-sm-right m-auto">
                      <abp-pagination-controls
                        id="server"
                        (pageChange)="getDataPage($event)"
                      >
                      </abp-pagination-controls>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
      </div>
      <!-- Order Detail Modal -->
       <order-detail *ngIf="orderId" [orderId]="orderId"></order-detail>
    </section>

    <section class="user-card orders-section" *ngIf="tabActive == 'History'">
      <history></history>
    </section>
  </main>
    </div>

</div>