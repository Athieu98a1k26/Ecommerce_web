
<abp-modal-header
    [title]="'ConfirmOrder' | localize"
    (onCloseClick)="bsModalRef.hide()"
  ></abp-modal-header>
  <div class="modal-body">
    <div class="product-detail-page container-custom-xxl">
      <div class="row product-main-row">
        <div class="col-md-6 product-left">
          <section class="image-carousel-section">
            <div class="carousel-container">
              <div class="carousel-wrapper" [style.transform]="'translateX(-' + (currentImageIndex * 100) + '%)'">
                <div class="carousel-slide" *ngFor="let detail of product?.listProductStoreDetailDto; let i = index" (click)="openImageModal(i)">
                  <img [src]="detail.pathImage" [alt]="product?.productName + ' ' + (i + 1)" class="product-image" />
                </div>
              </div>
              <button class="carousel-nav carousel-prev" (click)="prevImage()" *ngIf="countDetail > 1">
                <i class="fas fa-chevron-left"></i>
              </button>
              <button class="carousel-nav carousel-next" (click)="nextImage()" *ngIf="countDetail > 1">
                <i class="fas fa-chevron-right"></i>
              </button>
              <div class="carousel-dots" *ngIf="countDetail > 1">
                <span class="dot" *ngFor="let image of product?.listProductStoreDetailDto; let i = index"
                  [class.active]="i === currentImageIndex"
                  (click)="goToImage(i)"></span>
              </div>
            </div>
            <div class="thumbnail-gallery" *ngIf="countDetail > 1">
              <div class="thumbnail-scroll">
                <div class="thumbnail-item"
                     *ngFor="let detail of product?.listProductStoreDetailDto; let i = index"
                     [class.active]="i === currentImageIndex"
                     (click)="goToImage(i)">
                  <img [src]="detail.pathImage" [alt]="'Thumbnail ' + (i + 1)" class="thumbnail-image" />
                </div>
              </div>
            </div>
          </section>
          <ng-container *ngIf="showImageModal">
            <div class="image-modal" (click)="closeImageModal()">
              <div class="modal-content" (click)="$event.stopPropagation()">
                <button class="modal-close" (click)="closeImageModal()">
                  <i class="fas fa-times"></i>
                </button>
                <div class="modal-carousel">
                  <div class="modal-wrapper" [style.transform]="'translateX(-' + (modalImageIndex * 100) + '%)'">
                    <div class="modal-slide" *ngFor="let detail of product?.listProductStoreDetailDto">
                      <img [src]="detail.pathImage" [alt]="product?.productName" class="modal-image" />
                    </div>
                  </div>
                  <button class="modal-nav modal-prev" (click)="prevModalImage()">
                    <i class="fas fa-chevron-left"></i>
                  </button>
                  <button class="modal-nav modal-next" (click)="nextModalImage()">
                    <i class="fas fa-chevron-right"></i>
                  </button>
                  <div class="modal-counter">
                    {{ modalImageIndex + 1 }} / {{ countDetail }}
                  </div>
                </div>
              </div>
            </div>
          </ng-container>
        </div>
        <!-- Product details right column -->
        <div class="col-md-6 product-right">
          <section class="product-info-section">
            <div class="product-info-card">
              <h2 class="product-title">{{ product?.productName }}</h2>
              <div class="rating-sold-row">
                <div class="rating-group">
                  <div class="stars">
                    <ng-container *ngFor="let star of getStarArray(product?.stars)">
                      <i class="fas fa-star"
                         [ngClass]="{ 'full': star === 1, 'half': star === 0.5 }"></i>
                    </ng-container>
                  </div>
                  <span class="rating-value">{{ product?.stars }}</span>
                </div>
                <div class="divider">|</div>
                <span class="review-count">0 đánh giá</span>
                <div class="divider">|</div>
                <span class="sold-count">Đã thuê {{ product?.sold | number }}</span>
              </div>
              <div class="price-section flex">
                <div class="current-price-wrapper">
                  <span class="current-price">{{ selectedDetail?.price | number }}₫</span>
                </div>
                
              </div>
            </div>
          </section>
          
          <section class="version-selection-section" *ngIf="hasVersion">
            <div class="selection-card">
              <h3 class="selection-title">Lựa chọn phiên bản</h3>
              <div class="version-options">
                <div class="version-option-card"
                     *ngFor="let detail of activeCapacityCodeDetails"
                     [class.selected]="detail.id == selectedDetail.id"
                     (click)="selectVersion(detail)">
                  <div class="version-name">{{ detail.capacityCode }}</div>
                  <div class="version-price">{{ detail.price | number }}₫</div>
                  <div class="selected-check" *ngIf="detail.id == selectedDetail.id">
                    <i class="fas fa-check"></i>
                  </div>
                </div>
              </div>
            </div>
          </section>
          <section 
            class="color-selection-section" 
            *ngIf="hasColor">
            <div class="selection-card">
              <h3 class="selection-title">Lựa chọn màu và xem địa chỉ còn hàng</h3>
              <div class="color-options">
                <ng-container *ngFor="let detail of activeColorCodeDetails">
                  <ng-container>
                    <div class="color-option-card"
                         [class.selected]="detail.id == selectedDetail.id"
                         (click)="selectColor(detail)">
                      
                      <div class="color-info">
                        <div class="color-name">{{ detail.colorCode }}</div>
                        <div class="color-price">{{ detail.price | number }}₫</div>
                      </div>
                      <div class="selected-check" *ngIf="detail.id == selectedDetail.id">
                        <i class="fas fa-check"></i>
                      </div>
                    </div>
                  </ng-container>
                </ng-container>
              </div>
            </div>
          </section>
          <section class="product-config-section">
            <div class="config-card">
              <div class="config-row">
                <div class="config-field">
                  <label class="field-label">Số lượng:</label>
                  <div class="quantity-controls">
                    <button class="quantity-btn" (click)="decreaseQuantity()" [disabled]="quantity <= 1">
                      <i class="fas fa-minus"></i>
                    </button>
                    <input type="number" class="quantity-input" [(ngModel)]="quantity" min="1" [readonly]="true">
                    <button class="quantity-btn" (click)="increaseQuantity()">
                      <i class="fas fa-plus"></i>
                    </button>
                  </div>
                </div>
                <div class="config-field machine-condition-field">
                  <label class="field-label">
                    <i class="fas fa-cogs"></i>
                    Tình trạng máy:
                  </label>
                  <div class="field-value machine-condition-badge">
                    {{selectedDetail?.machineConditionCode}}
                  </div>
                </div>
                <div class="config-field lease-term-field">
                  <label class="field-label">
                    <i class="fas fa-clock"></i>
                    Thời gian thuê:
                  </label>
                  <div class="field-value lease-term-badge">
                    {{selectedDetail?.leaseTermCode}}
                  </div>
                </div>
                <style>
                  
                </style>
              </div>
              <div class="stock-info">Còn {{ getStock() }} sản phẩm</div>
            </div>
          </section>
    
          
        </div>
      </div>
      <section class="customer-delivery-section">
        <div class="info-card">
          <h3 class="section-title">Thông tin khách hàng &amp; Giao hàng</h3>
          <div class="form-grid">
            <div class="form-group">
              <label class="form-label">Họ và tên <span class="required">*</span></label>
              <input type="text" class="form-input" [(ngModel)]="customerInfo.fullName" placeholder="Nhập họ và tên" />
            </div>
            <div class="form-group">
              <label class="form-label">Số điện thoại <span class="required">*</span></label>
              <input type="tel" class="form-input" [(ngModel)]="customerInfo.phone" placeholder="Nhập số điện thoại" />
            </div>
            <div class="form-group">
              <label class="form-label">Email <span class="required">*</span></label>
              <input type="email" class="form-input" [(ngModel)]="customerInfo.email" placeholder="Nhập email" />
            </div>
          </div>
          <div class="delivery-options">
            <div class="delivery-option-card"
              [class.selected]="deliveryMethod === deliveryMethodHome"
              (click)="selectDeliveryMethod('HomeDelivery')">
              <div class="radio-indicator">
                <div class="radio-circle" [class.filled]="deliveryMethod === deliveryMethodHome"></div>
              </div>
              <div class="option-content">
                <div class="option-title">Nhận hàng tại nhà</div>
                <div class="option-description">Giao hàng tận nơi</div>
              </div>
            </div>
            <div class="delivery-option-card"
              [class.selected]="deliveryMethod === deliveryMethodStore"
              (click)="selectDeliveryMethod('InStore')">
              <div class="radio-indicator">
                <div class="radio-circle" [class.filled]="deliveryMethod === deliveryMethodStore"></div>
              </div>
              <div class="option-content">
                <div class="option-title">Nhận hàng tại cửa hàng</div>
                <div class="option-description">Đến cửa hàng để nhận</div>
              </div>
            </div>
          </div>
          <br>
          <div class="form-grid" *ngIf="deliveryMethod == deliveryMethodHome">
            <div class="form-group">
              <label class="form-label">Tỉnh/Thành phố <span class="required">*</span></label>
              <select class="form-select" 
                      [(ngModel)]="deliveryAddress.province"
                      (change)="onProvinceChange()">
                <option value="">Chọn tỉnh/ thành phố</option>
                <option *ngFor="let province of listProvince" [value]="province.code">{{ province.name }}</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">Phường xã <span class="required">*</span></label>
              <select class="form-select" [(ngModel)]="deliveryAddress.ward">
                <option value="">Chọn phường xã</option>
                <option *ngFor="let ward of listWard" [value]="ward.code">{{ ward.name }}</option>
              </select>
            </div>
          </div>
        </div>
      </section>
      <section class="order-details-section">
        <div class="info-card">
          <h3 class="section-title">Chi tiết đơn hàng</h3>
          <div class="form-group">
            <label class="form-label">Ghi chú</label>
            <textarea class="form-textarea"
                      [(ngModel)]="notes"
                      placeholder="Nhập ghi chú (nếu có)"
                      rows="2"></textarea>
          </div>
        </div>
      </section>
    </div>
  </div>
  <abp-modal-footer
    [cancelDisabled]="saving"
    [saveDisabled]="saving"
    (onSaveClick)="save()"
    (onCancelClick)="bsModalRef.hide()"
  ></abp-modal-footer>
