<div class="product-detail-page container-custom-xxl">
  <div class="product-main-row row">
    <!-- Left Column: Image Carousel & Modal -->
    <div class="product-left col-md-6">
      <!-- Product Image Carousel -->
      <section class="image-carousel-section">
        <div class="carousel-container">
          <div class="carousel-wrapper" [style.transform]="'translateX(-' + (currentImageIndex * 100) + '%)'">
            <div class="carousel-slide" *ngFor="let image of product.images; let i = index" (click)="openImageModal(i)">
              <img [src]="image" [alt]="product.name + ' ' + (i + 1)" class="product-image">
            </div>
          </div>
          <!-- Navigation Arrows -->
          <button class="carousel-nav carousel-prev" (click)="prevImage()" *ngIf="product.images.length > 1">
            <i class="fas fa-chevron-left"></i>
          </button>
          <button class="carousel-nav carousel-next" (click)="nextImage()" *ngIf="product.images.length > 1">
            <i class="fas fa-chevron-right"></i>
          </button>
          <!-- Pagination Dots -->
          <div class="carousel-dots" *ngIf="product.images.length > 1">
            <span class="dot" 
                  *ngFor="let image of product.images; let i = index"
                  [class.active]="i === currentImageIndex"
                  (click)="goToImage(i)">
            </span>
          </div>
        </div>
        <!-- Thumbnail Gallery -->
        <div class="thumbnail-gallery" *ngIf="product.images.length > 1">
          <div class="thumbnail-scroll">
            <div class="thumbnail-item"
                 *ngFor="let image of product.images; let i = index"
                 [class.active]="i === currentImageIndex"
                 (click)="goToImage(i)">
              <img [src]="image" [alt]="'Thumbnail ' + (i + 1)" class="thumbnail-image">
            </div>
          </div>
        </div>
      </section>
      <!-- Image Modal/Fullscreen Viewer -->
      <div class="image-modal" *ngIf="showImageModal" (click)="closeImageModal()">
        <div class="modal-content" (click)="$event.stopPropagation()">
          <button class="modal-close" (click)="closeImageModal()">
            <i class="fas fa-times"></i>
          </button>
          <div class="modal-carousel">
            <div class="modal-wrapper" [style.transform]="'translateX(-' + (modalImageIndex * 100) + '%)'">
              <div class="modal-slide" *ngFor="let image of product.images">
                <img [src]="image" [alt]="product.name" class="modal-image">
              </div>
            </div>
            <button class="modal-nav modal-prev" (click)="prevModalImage()">
              <i class="fas fa-chevron-left"></i>
            </button>
            <button class="modal-nav modal-next" (click)="nextModalImage()">
              <i class="fas fa-chevron-right"></i>
            </button>
            <div class="modal-counter">
              {{ modalImageIndex + 1 }} / {{ product.images.length }}
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Right Column: Product Information, Options, etc. -->
    <div class="product-right col-md-6">
      <!-- Product Info Card -->
      <section class="product-info-section">
        <div class="product-info-card">
          <!-- Product Title -->
          <h2 class="product-title">{{ product.name }}</h2>
          <!-- Rating and Sold Info -->
          <div class="rating-sold-row">
            <div class="rating-group">
              <div class="stars">
                <i class="fas fa-star" *ngFor="let star of getStarArray(product.rating)"
                   [class.full]="star === 1"
                   [class.half]="star === 0.5"></i>
              </div>
              <span class="rating-value">{{ product.rating }}</span>
            </div>
            <div class="divider">|</div>
            <span class="review-count">{{ product.reviewCount }} đánh giá</span>
            <div class="divider">|</div>
            <span class="sold-count">Đã thuê {{ product.sold | number }}</span>
          </div>
          <!-- Price Section -->
          <div class="price-section flex">
            <div class="current-price-wrapper">
              <span class="current-price">{{ product.currentPrice | number }}₫</span>
              <span class="discount-badge">-{{ product.discount }}%</span>
            </div>
            &nbsp;
            <div class="original-price-wrapper">
              <span class="original-price">{{ product.originalPrice | number }}₫</span>
            </div>
          </div>
        </div>
      </section>
      <!-- Version Selection Section -->
      <section class="version-selection-section">
        <div class="selection-card">
          <h3 class="selection-title">Lựa chọn phiên bản</h3>
          <div class="version-options">
            <div class="version-option-card"
                 *ngFor="let version of product.versions"
                 [class.selected]="selectedVersion === version.value"
                 (click)="selectVersion(version.value)">
              <div class="version-name">{{ version.name }}</div>
              <div class="version-price">{{ version.price | number }}₫</div>
              <div class="selected-check" *ngIf="selectedVersion === version.value">
                <i class="fas fa-check"></i>
              </div>
            </div>
          </div>
        </div>
      </section>
      <!-- Color Selection Section -->
      <section class="color-selection-section">
        <div class="selection-card">
          <h3 class="selection-title">Lựa chọn màu và xem địa chỉ còn hàng</h3>
          <div class="color-options">
            <div class="color-option-card"
                 *ngFor="let color of product.colors"
                 [class.selected]="selectedColor === color.value"
                 (click)="selectColor(color.value)">
              <div class="color-thumbnail">
                <img [src]="color.image" [alt]="color.name" class="color-image">
              </div>
              <div class="color-info">
                <div class="color-name">{{ color.name }}</div>
                <div class="color-price">{{ color.price | number }}₫</div>
              </div>
              <div class="selected-check" *ngIf="selectedColor === color.value">
                <i class="fas fa-check"></i>
              </div>
            </div>
          </div>
        </div>
      </section>
      <!-- Flash Deal Countdown -->
      <!--
      <section class="countdown-section">
        <div class="countdown-label">
          <i class="fas fa-bolt"></i>
          <span>Flash Deal kết thúc sau:</span>
        </div>
        <div class="countdown-timer">
          <div class="countdown-item">
            <span class="countdown-value">{{ timeRemaining.hours | number:'2.0' }}</span>
            <span class="countdown-label-small">Giờ</span>
          </div>
          <span class="countdown-separator">:</span>
          <div class="countdown-item">
            <span class="countdown-value">{{ timeRemaining.minutes | number:'2.0' }}</span>
            <span class="countdown-label-small">Phút</span>
          </div>
          <span class="countdown-separator">:</span>
          <div class="countdown-item">
            <span class="countdown-value">{{ timeRemaining.seconds | number:'2.0' }}</span>
            <span class="countdown-label-small">Giây</span>
          </div>
        </div>
      </section>
      -->
      <!-- Product Configuration Section -->
      <section class="product-config-section">
        <div class="config-card">
          <div class="config-row">
            <div class="config-field">
              <label class="field-label">Số lượng:</label>
              <div class="quantity-controls">
                <button class="quantity-btn" (click)="decreaseQuantity()" [disabled]="quantity <= 1">
                  <i class="fas fa-minus"></i>
                </button>
                <input type="number" class="quantity-input" [(ngModel)]="quantity" min="1" readonly>
                <button class="quantity-btn" (click)="increaseQuantity()">
                  <i class="fas fa-plus"></i>
                </button>
              </div>
            </div>
            <div class="config-field">
              <label class="field-label">Tình trạng máy:</label>
              <select class="form-select" [(ngModel)]="deviceCondition">
                <option value="new">Máy mới 100%</option>
                <option value="like-new">Như mới</option>
                <option value="good">Tốt</option>
              </select>
            </div>
            <div class="config-field">
              <label class="field-label">Thời gian thuê:</label>
              <select class="form-select" [(ngModel)]="rentalDuration">
                <option value="1">1 Tháng</option>
                <option value="2">2 Tháng</option>
                <option value="3">3 Tháng</option>
                <option value="4">4 Tháng</option>
                <option value="6">6 Tháng</option>
                <option value="12">12 Tháng</option>
              </select>
            </div>
          </div>
          <div class="stock-info">Còn {{ 50 - quantity }} sản phẩm</div>
        </div>
      </section>
    </div>
  </div>
  <!-- Customer Information & Delivery Section -->
  <section class="customer-delivery-section">
    <div class="info-card">
      <h3 class="section-title">Thông tin khách hàng & Giao hàng</h3>
      <div class="form-grid">
        <div class="form-group">
          <label class="form-label">Họ và tên <span class="required">*</span></label>
          <input type="text" class="form-input" [(ngModel)]="customerInfo.fullName" placeholder="Nhập họ và tên">
        </div>
        <div class="form-group">
          <label class="form-label">Số điện thoại <span class="required">*</span></label>
          <input type="tel" class="form-input" [(ngModel)]="customerInfo.phone" placeholder="Nhập số điện thoại">
        </div>
        <div class="form-group">
          <label class="form-label">Email <span class="required">*</span></label>
          <input type="email" class="form-input" [(ngModel)]="customerInfo.email" placeholder="Nhập email">
        </div>
      </div>
      <div class="delivery-options">
        <div class="delivery-option-card"
             [class.selected]="deliveryMethod === 'home'"
             (click)="selectDeliveryMethod('home')">
          <div class="radio-indicator">
            <div class="radio-circle" [class.filled]="deliveryMethod === 'home'"></div>
          </div>
          <div class="option-content">
            <div class="option-title">Nhận hàng tại nhà</div>
            <div class="option-description">Giao hàng tận nơi</div>
          </div>
        </div>
        <div class="delivery-option-card"
             [class.selected]="deliveryMethod === 'store'"
             (click)="selectDeliveryMethod('store')">
          <div class="radio-indicator">
            <div class="radio-circle" [class.filled]="deliveryMethod === 'store'"></div>
          </div>
          <div class="option-content">
            <div class="option-title">Nhận hàng tại cửa hàng</div>
            <div class="option-description">Đến cửa hàng để nhận</div>
          </div>
        </div>
      </div>
      <br/>
      <div class="form-grid">
        <div class="form-group">
          <label class="form-label">Tỉnh/Thành phố <span class="required">*</span></label>
          <select class="form-select" [(ngModel)]="deliveryAddress.province" [disabled]="deliveryMethod === 'store'">
            <option value="">Chọn tỉnh/thành phố</option>
            <option value="hcm">Hồ Chí Minh</option>
            <option value="hn">Hà Nội</option>
            <option value="dn">Đà Nẵng</option>
            <option value="hp">Hải Phòng</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Cửa hàng <span class="required">*</span></label>
          <select class="form-select" [(ngModel)]="deliveryAddress.store" [disabled]="deliveryMethod === 'home'">
            <option value="">Chọn cửa hàng</option>
            <option value="store1">Cửa hàng 1 - Quận 1</option>
            <option value="store2">Cửa hàng 2 - Quận 3</option>
            <option value="store3">Cửa hàng 3 - Quận 7</option>
          </select>
        </div>
      </div>
    </div>
  </section>
  <!-- Order Details Section -->
  <section class="order-details-section">
    <div class="info-card">
      <h3 class="section-title">Chi tiết đơn hàng</h3>
      <div class="form-group">
        <label class="form-label">Ghi chú</label>
        <textarea class="form-textarea"
                  [(ngModel)]="notes"
                  placeholder="Nhập ghi chú (nếu có)"
                  rows="4"></textarea>
      </div>
      <div class="checkbox-group">
        <label class="checkbox-label">
          <input type="checkbox"
                 class="checkbox-input"
                 [(ngModel)]="requireInvoice">
          <span class="checkbox-text">Yêu cầu xuất hóa đơn công ty (Vui lòng điền email để nhận hóa đơn VAT)</span>
        </label>
      </div>
      <div class="voucher-input-group">
        <input type="text"
               class="voucher-input"
               [(ngModel)]="voucherCode"
               placeholder="Mã giảm giá (Nếu có)">
        <button class="voucher-btn" (click)="applyVoucher()">Sử dụng</button>
      </div>
    </div>
  </section>
  <!-- Product Description & Details Tabs -->
  <section class="details-tabs-section">
    <div class="details-tabs-card">
      <div class="tabs-header">
        <button class="tab-button"
                [class.active]="descriptionExpanded"
                (click)="toggleDescription(); showSpecs = false; showReviews = false; showQA = false;">
          Mô tả
        </button>
        <button class="tab-button"
                [class.active]="showSpecs"
                (click)="toggleSpecs(); descriptionExpanded = false; showReviews = false; showQA = false;">
          Thông số
        </button>
        <button class="tab-button"
                [class.active]="showReviews"
                (click)="toggleReviews(); descriptionExpanded = false; showSpecs = false; showQA = false;">
          Đánh giá
        </button>
        <button class="tab-button"
                [class.active]="showQA"
                (click)="toggleQA(); descriptionExpanded = false; showSpecs = false; showReviews = false;">
          Hỏi đáp
        </button>
      </div>
      <!-- Description Tab Content -->
      <div class="tab-content" [class.active]="descriptionExpanded">
        <div class="description-content">
          <p>Ấm điện đun nước 2.5L với công suất 1500W, đun nước nhanh chóng và tiết kiệm điện. Sản phẩm có tính năng tự động tắt khi nước sôi, đảm bảo an toàn cho người sử dụng.</p>
          <p><strong>Đặc điểm nổi bật:</strong></p>
          <ul>
            <li>Dung tích 2.5L, phù hợp cho gia đình 2-4 người</li>
            <li>Công suất 1500W, đun nước nhanh trong 3-5 phút</li>
            <li>Tự động tắt khi nước sôi, an toàn và tiết kiệm điện</li>
            <li>Chống tràn, chống quá nhiệt</li>
            <li>Vỏ ngoài bằng nhựa PP cao cấp, cách nhiệt tốt</li>
            <li>Thiết kế hiện đại, dễ vệ sinh</li>
          </ul>
          <div class="rich-text-content">
            <h4>Hướng dẫn sử dụng:</h4>
            <ol>
              <li>Đổ nước vào ấm (không quá mức MAX)</li>
              <li>Cắm điện và bật công tắc</li>
              <li>Đợi nước sôi, ấm sẽ tự động tắt</li>
              <li>Rút phích cắm và sử dụng</li>
            </ol>
            <p><strong>Lưu ý:</strong> Không đổ nước quá mức quy định, không sử dụng khi ấm bị hư hỏng.</p>
          </div>
        </div>
      </div>
      <!-- Specifications Tab Content -->
      <div class="tab-content" [class.active]="showSpecs">
        <div class="specs-content">
          <table class="specs-table">
            <tr>
              <td class="spec-label">Dung tích</td>
              <td class="spec-value">{{ product.specifications.capacity }}</td>
            </tr>
            <tr>
              <td class="spec-label">Công suất</td>
              <td class="spec-value">{{ product.specifications.power }}</td>
            </tr>
            <tr>
              <td class="spec-label">Chất liệu</td>
              <td class="spec-value">{{ product.specifications.material }}</td>
            </tr>
            <tr>
              <td class="spec-label">Tính năng an toàn</td>
              <td class="spec-value">{{ product.specifications.safety }}</td>
            </tr>
            <tr>
              <td class="spec-label">Kích thước</td>
              <td class="spec-value">{{ product.specifications.dimensions }}</td>
            </tr>
            <tr>
              <td class="spec-label">Trọng lượng</td>
              <td class="spec-value">{{ product.specifications.weight }}</td>
            </tr>
            <tr>
              <td class="spec-label">Bảo hành</td>
              <td class="spec-value">{{ product.specifications.warranty }}</td>
            </tr>
          </table>
        </div>
      </div>
      <!-- Reviews Tab Content -->
      <div class="tab-content" [class.active]="showReviews">
        <div class="reviews-tab-content">
          <!-- Star Distribution -->
          <div class="star-distribution">
            <div class="overall-rating">
              <div class="rating-score">{{ product.rating }}</div>
              <div class="rating-stars">
                <i class="fas fa-star" *ngFor="let star of getStarArray(product.rating)"
                   [class.full]="star === 1"
                   [class.half]="star === 0.5"></i>
              </div>
              <div class="rating-total">{{ getTotalReviews() }} đánh giá</div>
            </div>
            <div class="star-bars">
              <div class="star-bar" *ngFor="let count of [5,4,3,2,1]; let i = index">
                <span class="star-label">{{ count }} <i class="fas fa-star"></i></span>
                <div class="bar-container">
                  <div class="bar-fill" [style.width.%]="(product.starDistribution[count] / getTotalReviews()) * 100"></div>
                </div>
                <span class="bar-count">{{ product.starDistribution[count] }}</span>
              </div>
            </div>
          </div>
          <!-- Review List -->
          <div class="review-list">
            <div class="review-item" *ngFor="let review of product.reviews">
              <div class="review-header">
                <div class="review-user">
                  <div class="user-avatar-small">{{ review.user.charAt(0) }}</div>
                  <div class="user-info">
                    <div class="user-name">{{ review.user }}</div>
                    <div class="review-rating">
                      <i class="fas fa-star" *ngFor="let i of [1,2,3,4,5]" [class.active]="i <= review.rating"></i>
                    </div>
                  </div>
                </div>
                <div class="review-date">{{ review.date }}</div>
              </div>
              <div class="review-comment">{{ review.comment }}</div>
              <div class="review-footer">
                <button class="helpful-btn">
                  <i class="fas fa-thumbs-up"></i>
                  Hữu ích ({{ review.helpful }})
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- Q&A Tab Content -->
      <div class="tab-content" [class.active]="showQA">
        <div class="qa-content">
          <div class="qa-item" *ngFor="let item of product.qa">
            <div class="qa-question">
              <i class="fas fa-question-circle"></i>
              <div class="qa-question-text">
                <strong>{{ item.question }}</strong>
                <span class="qa-date">{{ item.date }}</span>
              </div>
            </div>
            <div class="qa-answer">
              <i class="fas fa-check-circle"></i>
              <span>{{ item.answer }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
  <!-- Related Products -->
  <section class="related-products-section">
    <div class="related-products-card">
      <h3 class="section-title">Có thể bạn cũng thích</h3>
      <div class="related-products-carousel">
        <div class="related-products-scroll">
          <product-item *ngFor="let relatedProduct of product.relatedProducts" [product]="relatedProduct"></product-item>
          
        </div>
      </div>
    </div>
  </section>
  <!-- Sticky Bottom Action Bar -->
  <div class="bottom-action-bar">
    <button class="action-btn cart-btn" (click)="addToCart()">
      <i class="fas fa-shopping-cart"></i>
      <span>Thêm vào giỏ</span>
    </button>
    <button class="action-btn buy-btn" (click)="buyNow()">
      <span>Mua ngay</span>
    </button>
  </div>
</div>
