<div class="product-detail-page container-custom-xxl">
  <div class="row product-main-row">
    <div class="col-md-6 product-left">
      <section class="image-carousel-section">
        <div class="carousel-container">
          <div class="carousel-wrapper" [style.transform]="'translateX(-' + (currentImageIndex * 100) + '%)'">
            <div class="carousel-slide" *ngFor="let detail of product?.listProductStoreDetailDto; let i = index" (click)="openImageModal(i)">
              <img [src]="detail.pathImage" [alt]="product?.productName + ' ' + (i + 1)" class="product-image" />
            </div>
          </div>
          <button class="carousel-nav carousel-prev" (click)="prevImage()" *ngIf="countDetail > 1">
            <i class="fas fa-chevron-left"></i>
          </button>
          <button class="carousel-nav carousel-next" (click)="nextImage()" *ngIf="countDetail > 1">
            <i class="fas fa-chevron-right"></i>
          </button>
          <div class="carousel-dots" *ngIf="countDetail > 1">
            <span class="dot" *ngFor="let image of product?.listProductStoreDetailDto; let i = index"
              [class.active]="i === currentImageIndex"
              (click)="goToImage(i)"></span>
          </div>
        </div>
        <div class="thumbnail-gallery" *ngIf="countDetail > 1">
          <div class="thumbnail-scroll">
            <div class="thumbnail-item"
                 *ngFor="let detail of product?.listProductStoreDetailDto; let i = index"
                 [class.active]="i === currentImageIndex"
                 (click)="goToImage(i)">
              <img [src]="detail.pathImage" [alt]="'Thumbnail ' + (i + 1)" class="thumbnail-image" />
            </div>
          </div>
        </div>
      </section>
      <ng-container *ngIf="showImageModal">
        <div class="image-modal" (click)="closeImageModal()">
          <div class="modal-content" (click)="$event.stopPropagation()">
            <button class="modal-close" (click)="closeImageModal()">
              <i class="fas fa-times"></i>
            </button>
            <div class="modal-carousel">
              <div class="modal-wrapper" [style.transform]="'translateX(-' + (modalImageIndex * 100) + '%)'">
                <div class="modal-slide" *ngFor="let detail of product?.listProductStoreDetailDto">
                  <img [src]="detail.pathImage" [alt]="product?.productName" class="modal-image" />
                </div>
              </div>
              <button class="modal-nav modal-prev" (click)="prevModalImage()">
                <i class="fas fa-chevron-left"></i>
              </button>
              <button class="modal-nav modal-next" (click)="nextModalImage()">
                <i class="fas fa-chevron-right"></i>
              </button>
              <div class="modal-counter">
                {{ modalImageIndex + 1 }} / {{ countDetail }}
              </div>
            </div>
          </div>
        </div>
      </ng-container>
    </div>
    <!-- Product details right column -->
    <div class="col-md-6 product-right">
      <section class="product-info-section">
        <div class="product-info-card">
          <h2 class="product-title">{{ product?.productName }}</h2>
          <div class="rating-sold-row">
            <div class="rating-group">
              <div class="stars">
                <ng-container *ngFor="let star of getStarArray(product?.stars)">
                  <i class="fas fa-star"
                     [ngClass]="{ 'full': star === 1, 'half': star === 0.5 }"></i>
                </ng-container>
              </div>
              <span class="rating-value">{{ product?.stars }}</span>
            </div>
            <div class="divider">|</div>
            <span class="review-count">0 đánh giá</span>
            <div class="divider">|</div>
            <span class="sold-count">Đã thuê {{ product?.sold | number }}</span>
          </div>
          <div class="price-section flex">
            <div class="current-price-wrapper">
              <span class="current-price">{{ selectedDetail?.price | number }}₫</span>
            </div>
            
          </div>
        </div>
      </section>
      
      <section class="version-selection-section" *ngIf="hasVersion">
        <div class="selection-card">
          <h3 class="selection-title">Lựa chọn phiên bản</h3>
          <div class="version-options">
            <div class="version-option-card"
                 *ngFor="let detail of activeCapacityCodeDetails"
                 [class.selected]="detail.id == selectedDetail.id"
                 (click)="selectVersion(detail)">
              <div class="version-name">{{ detail.capacityCode }}</div>
              <div class="version-price">{{ detail.price | number }}₫</div>
              <div class="selected-check" *ngIf="detail.id == selectedDetail.id">
                <i class="fas fa-check"></i>
              </div>
            </div>
          </div>
        </div>
      </section>
      <section 
        class="color-selection-section" 
        *ngIf="hasColor">
        <div class="selection-card">
          <h3 class="selection-title">Lựa chọn màu và xem địa chỉ còn hàng</h3>
          <div class="color-options">
            <ng-container *ngFor="let detail of activeColorCodeDetails">
              <ng-container>
                <div class="color-option-card"
                     [class.selected]="detail.id == selectedDetail.id"
                     (click)="selectColor(detail)">
                  
                  <div class="color-info">
                    <div class="color-name">{{ detail.colorCode }}</div>
                    <div class="color-price">{{ detail.price | number }}₫</div>
                  </div>
                  <div class="selected-check" *ngIf="detail.id == selectedDetail.id">
                    <i class="fas fa-check"></i>
                  </div>
                </div>
              </ng-container>
            </ng-container>
          </div>
        </div>
      </section>
      <section class="product-config-section">
        <div class="config-card">
          <div class="config-row">
            <div class="config-field">
              <label class="field-label">Số lượng:</label>
              <div class="quantity-controls">
                <button class="quantity-btn" (click)="decreaseQuantity()" [disabled]="quantity <= 1">
                  <i class="fas fa-minus"></i>
                </button>
                <input type="number" class="quantity-input" [(ngModel)]="quantity" min="1" [readonly]="true">
                <button class="quantity-btn" (click)="increaseQuantity()">
                  <i class="fas fa-plus"></i>
                </button>
              </div>
            </div>
            <div class="config-field machine-condition-field">
              <label class="field-label">
                <i class="fas fa-cogs"></i>
                Tình trạng máy:
              </label>
              <div class="field-value machine-condition-badge">
                {{selectedDetail?.machineConditionCode}}
              </div>
            </div>
            <div class="config-field lease-term-field">
              <label class="field-label">
                <i class="fas fa-clock"></i>
                Thời gian thuê:
              </label>
              <div class="field-value lease-term-badge">
                {{selectedDetail?.leaseTermCode}}
              </div>
            </div>
            <style>
              
            </style>
          </div>
          <div class="stock-info">Còn {{ getStock() }} sản phẩm</div>
        </div>
      </section>

      <div class="bottom-action-bar enhanced-bottom-action-bar">
        <button class="action-btn cart-btn enhanced-cart-btn" (click)="addToCart()">
          <i class="fas fa-shopping-cart"></i>
          <span>Thêm vào giỏ</span>
        </button>
        <button class="action-btn buy-btn enhanced-buy-btn" (click)="buyNow()">
          <span>Mua ngay</span>
        </button>
      </div>
    </div>
  </div>

  <section class="details-tabs-section">
    <div class="details-tabs-card">
      <div class="tabs-header">
        <button class="tab-button"
          [class.active]="tabActive === 'description'"
          (click)="setTab('description')">Mô tả</button>
        <button class="tab-button"
          [class.active]="tabActive === 'specs'"
          (click)="setTab('specs')">Thông số</button>
        <button class="tab-button"
          [class.active]="tabActive === 'reviews'"
          (click)="setTab('reviews')">Đánh giá</button>
        <button class="tab-button"
          [class.active]="tabActive === 'qa'"
          (click)="setTab('qa')">Hỏi đáp</button>
      </div>
      <div class="tab-content" [class.active]="tabActive === 'description'">
        
      </div>
      <div class="tab-content" [class.active]="tabActive === 'specs'">
        <div class="specs-content">
          <table class="specs-table">
            
          </table>
        </div>
      </div>
      <div class="tab-content" [class.active]="tabActive === 'reviews'">
        <div class="reviews-tab-content">
          <div class="star-distribution">
            <div class="overall-rating">
              <div class="rating-score">{{ product?.stars }}</div>
              <div class="rating-stars">
                <ng-container *ngFor="let star of getStarArray(product?.stars)">
                  <i class="fas fa-star"
                     [ngClass]="{ 'full': star === 1, 'half': star === 0.5 }"></i>
                </ng-container>
              </div>
              <div class="rating-total">5 đánh giá</div>
            </div>
            <div class="star-bars">
              <div class="star-bar" *ngFor="let count of [5,4,3,2,1]">
                <span class="star-label">{{ count }} <i class="fas fa-star"></i></span>
                <div class="bar-container">
                  <div class="bar-fill" [style.width.%]="2"></div>
                </div>
                <span class="bar-count">0</span>
              </div>
            </div>
          </div>
          <div class="review-list">
            
          </div>
        </div>
      </div>
      <div class="tab-content" [class.active]="tabActive === 'qa'">
        
      </div>
    </div>
  </section>
  <section class="related-products-section">
    <div class="related-products-card">
      <h3 class="section-title">Có thể bạn cũng thích</h3>
      <div class="related-products-carousel">
        <div class="related-products-scroll">
          <product-item *ngFor="let relatedProduct of products" [product]="relatedProduct"></product-item>
        </div>
      </div>
    </div>
  </section>
  
</div>
